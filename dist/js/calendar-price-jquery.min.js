/*! Calendar-pirce-jquery v1.0.2 | (c) Capricorncd | https://github.com/capricorncd/calendar-pirce-jquery */"use strict";!function($){function CalendarPrice(t){t.el||t.error&&t.error({code:1,msg:CODES[1]}),this.opts=$.extend({},CalendarPrice.DEFAULTS,t),this.createStyleCode(),this.startDate=this._getStartDate(),this.endDate=this._getEndDate(),this.data=this._getOptionsData(),this.month=this._formatThisMonth(this.opts.month),this.Initialization(),this.setupDayDetailWindow()}function formatDate(t,e){/(y+)/i.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));var a={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};for(var r in a)if(new RegExp("("+r+")").test(e)){var o=a[r]+"";e=e.replace(RegExp.$1,1===RegExp.$1.length?o:formatNumber(o))}return e}function formatNumber(t){return(t=t.toString())[1]?t:"0"+t}function toNumber(t){return t=parseInt(t),isNaN(t)?0:t}function isValid(t){return!!/^(\d{4})[-\/\.](\d{1,2})[-\/\.](\d{1,2})/.test(t)&&RegExp.$1+"/"+formatNumber(RegExp.$2)+"/"+formatNumber(RegExp.$3)}var CODES={1:"请配置日历显示的容器!",2:"{{text}}: 日期格式不合法!",3:"设置的日期范围或初始化的日期范围，与设置的周{{text}}没有交集",4:"开始日期格式错误",5:"开始日期不能小于今天",6:"结束日期格式错误",7:"结束日期不能小于开始日期",8:"sort(arg)方法的参数arg为非数组"},TODAY=new Date,today=formatDate(TODAY,"yyyy-MM-dd"),ONE_DAY_MSEC=864e5,tomorrow=formatDate(new Date(Date.parse(TODAY)+ONE_DAY_MSEC),"yyyy-MM-dd"),fn=CalendarPrice.prototype;CalendarPrice.DEFAULTS={data:[],month:formatDate(TODAY,"yyyy/MM"),startDate:formatDate(TODAY,"yyyy/MM/dd"),endDate:null,cancel:null,callback:null,error:null,hideFooterButton:!1,style:{bgColor:"#fff"}},fn._formatThisMonth=function(t){var e=null;return(e=/^(\d{4})[-\.\/](\d{1,2})/.test(t)?this.dateToObject(RegExp.$1+"/"+RegExp.$2):this.dateToObject(formatDate(TODAY,"yyyy/MM")))<=this.endDate&&e>=this.startDate?e:this.dateToObject(formatDate(this.startDate,"yyyy/MM"))},fn.Initialization=function(){this.createCalendar();var t=this;$(this.opts.el).on("click",".prev-month",function(){t._prevMonth()}),$(this.opts.el).on("click",".next-month",function(){t._nextMonth()}),this.setupPriceAndStock(),$(this.opts.el).on("click",".btn-reset",function(){t.data=t._getOptionsData(),t.createCalendar(),console.log("reset completed!")}),$(this.opts.el).on("click",".btn-confirm",function(){t.opts.callback&&t.opts.callback(t.data)}),$(this.opts.el).on("click",".btn-cancel",function(){t.opts.cancel&&t.opts.cancel()})},fn._prevMonth=function(){var t=toNumber(formatDate(this.month,"yyyy")),e=toNumber(formatDate(this.month,"MM"));this.month=1===e?this.dateToObject(t-1+"/12"):this.dateToObject(t+"/"+(e-1)),this.createCalendar()},fn._nextMonth=function(){var t=toNumber(formatDate(this.month,"yyyy")),e=toNumber(formatDate(this.month,"MM"));this.month=12===e?this.dateToObject(t+1+"/01"):this.dateToObject(t+"/"+(e+1)),this.createCalendar()},fn._getStartDate=function(){var t=this.dateToObject(this.opts.startDate);return t&&t>=TODAY?t:TODAY},fn._getEndDate=function(){var t=this.opts.endDate,e=null,a=null,r=null;return/^(\d{4})[-\.\/](\d{1,2})/.test(t)&&(e=RegExp.$1,a=toNumber(RegExp.$2)),e&&a||(e=toNumber(formatDate(TODAY,"yyyy"))+1,a=toNumber(formatDate(TODAY,"MM"))),r=/^\d{4}[-\.\/]\d{1,2}[-\.\/](\d{1,2})/.test(t)?RegExp.$1:new Date(Date.parse(new Date(e,a))-ONE_DAY_MSEC).getDate(),this.dateToObject(e+"/"+a+"/"+r)},fn.dateToObject=function(t){var e="";return/(\d{4})[-\/\.](\d{1,2})[-\/\.]?/.test(t)&&(e+=RegExp.$1+"/"+RegExp.$2),/[-\/\.]\d{1,2}[-\/\.](\d{1,2})/.test(t)?e+="/"+RegExp.$1:e+="/01",/\d{4}\/\d{1,2}\/\d{1,2}/.test(e)?new Date(e):(this.opts.error&&this.opts.error({code:2,msg:CODES[2].replace("{{text}}",t)}),!1)},fn.createCalendar=function(){var t=!0,e=!0,a=formatDate(this.month,"yyyyMM");formatDate(this.startDate,"yyyyMM")>=a&&(t=!1),formatDate(this.endDate,"yyyyMM")<=a&&(e=!1);var r="";r+='<div class="capricorncd-calendar-container">',r+='\t<div class="calendar-head-wrapper">',t&&(r+='       <a class="prev-month" title="上一月"></a>'),r+='\t\t<div class="calendar-month-title">'+formatDate(this.month,"yyyy年MM月")+"</div>",e&&(r+='       <a class="next-month" title="下一月"></a>'),r+="\t</div>",r+='\t<div class="calendar-table-wrapper">',r+='  \t    <table cellpadding="4" cellspacing="0">',r+='\t\t    <thead><tr class="week"><th class="weekend">日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th class="weekend">六</th></tr></thead>',r+="\t\t    <tbody>"+this._createTbody()+"</tbody>",r+="\t    </table>",r+="    </div>",this.opts.hideFooterButton||(r+='    <div class="calendar-foot-wrapper">',r+='        <button class="btn btn-reset">重置</button>',r+='        <button class="btn btn-confirm">确定</button>',r+='        <button class="btn btn-cancel">取消</button>',r+="    </div>"),r+="</div>",$(this.opts.el).html(r),this.renderDataToTalbe()},fn._createTbody=function(){for(var t=this._getMonthDays(),e=this.month.getDay(),a=0,r=Math.ceil((t+e)/7),o="",n="",c=0;c<r;c++){n+="<tr>";for(var d=1;d<=7;d++)(a=7*c+d-e)>0&&a<=t?(o=formatDate(this.month,"yyyy-MM-")+formatNumber(a),today==o&&(a="今天"),tomorrow==o&&(a="明天"),o>=formatDate(this.startDate,"yyyy-MM-dd")?n+='<td class="valid-hook" data-week="'+(d-1)+'" data-id="'+o+'"><b>'+a+'</b><div class="data-hook"></div></td>':n+='<td class="disabled"><b>'+a+"</b></td>"):n+="<td>&nbsp;</td>";n+="</tr>"}return n},fn.renderDataToTalbe=function(){var t=this,e=null;$(this.opts.el).find(".valid-hook").each(function(){e=t._getDateData($(this).data("id"));var a=t.dayComplate().toString();if(e){for(var r in e)a=a.replace("{"+r+"}",e[r]);$(this).data("data",JSON.stringify(e)).find(".data-hook").html(a)}else $(this).data("data","{}")})},fn._getDateData=function(t){for(var e=this.data,a=0;a<e.length;a++)if(t==e[a].date)return e[a];return null},fn._getMonthDays=function(){var t=this.month,e=formatDate(t,"yyyy"),a=formatDate(t,"MM");return 12==a?31:new Date(Date.parse(new Date(e,a,1))-ONE_DAY_MSEC).getDate()},fn.setupDayDetailWindow=function(){var t="";t+='<div class="cddsw-container">',t+='   <div class="cddsw-head-wrapper">',t+='       <div class="cddsw-title">0000-00-00</div>',t+='       <a class="cddsw-close"><i></i></a>',t+="   </div>",t+='   <ul class="cddsw-form-wrapper clearfix">',t+=this._createDaySetupInputGroup(),t+="   </ul>",t+='   <fieldset class="cddsw-batch-settings clearfix">',t+='       <legend class="bs-title"><b>批量设置</b></legend>',t+='       <div class="bs-content">',t+='           <lable class="bs-lable">日期范围</lable>',t+='           <div class="bs-options-wrapper">',t+='               <input class="itext" name="startDay" type="text">',t+='               <span class="white-space">-</span>',t+='               <input class="itext" name="endDay" type="text">',t+='               <label class="drw-enable"><input name="enableDateRange" type="checkbox"> 启用</label>',t+="           </div>",t+="       </div>",t+='       <div class="bs-content bs-week-chekbox">',t+='           <lable class="bs-lable">设置星期</lable>',t+='           <div class="bs-options-wrapper">',t+='               <label><input name="setWeek" type="checkbox" value="1"> 周一</label>',t+='               <label><input name="setWeek" type="checkbox" value="2"> 周二</label>',t+='               <label><input name="setWeek" type="checkbox" value="3"> 周三</label>',t+='               <label><input name="setWeek" type="checkbox" value="4"> 周四</label>',t+='               <label><input name="setWeek" type="checkbox" value="5"> 周五</label>',t+='               <label><input name="setWeek" type="checkbox" value="6"> 周六</label>',t+='               <label><input name="setWeek" type="checkbox" value="0"> 周日</label>',t+="           </div>",t+="       </div>",t+="   </fieldset>",t+='   <div class="cddsw-foot-wrapper">',t+='       <button class="btn-confirm">启用本设置</button>',t+='       <button class="btn-cancel">取消</button>',t+="   </div>",t+="</div>",$("body").append('<div class="capricorncd-date-detailed-settings" style="display: none">'+t+"</div>")},fn._createDaySetupInputGroup=function(){for(var t="",e=this.opts.config,a=0;a<e.length;a++){var r=e[a];t+="<li>",t+="   <label>"+r.name+"</label>",t+='   <input name="'+r.key+'" type="text">',t+="</li>"}return t},fn.dayComplate=function(){var t=this.opts.show,e="";if(t&&t instanceof Array)for(var a=0;a<t.length;a++){var r=t[a];e+="<p>"+r.name+"{"+r.key+"}</p>"}return e},fn.setupPriceAndStock=function(){var t=this;$(this.opts.el).on("click",".valid-hook",function(){var e=$(this).data("id"),a=$(this).data("data");try{a=JSON.parse(a)}catch(t){a={}}if(t.opts.everyday)t.opts.everyday(a);else{var r=$(".capricorncd-date-detailed-settings");r.find('.cddsw-form-wrapper [type="text"]').val(""),r.find('[name="enableDateRange"]').prop("checked",!1),r.find('[name="setWeek"]').prop("checked",!1),$.each(a,function(t,e){r.find('[name="'+t+'"]').val(e)}),r.find(".cddsw-title").html(e),r.find('[name="startDay"], [name="endDay"]').val(e),r.show()}}),$("body").on("click",".capricorncd-date-detailed-settings .cddsw-close, .capricorncd-date-detailed-settings .btn-cancel",function(){$(this).closest(".capricorncd-date-detailed-settings").hide()}),$("body").on("click",".capricorncd-date-detailed-settings .btn-confirm",function(){var e=$(this).closest(".cddsw-container"),a=e.find(".cddsw-title").text(),r={};e.find(".cddsw-form-wrapper [name]").each(function(){var t=$(this).attr("name"),e=$(this).val();r[t]=e}),r.date=a;var o=$(".cddsw-batch-settings"),n=o.find('[name="startDay"]').val(),c=o.find('[name="endDay"]').val(),d=o.find('[name="enableDateRange"]').prop("checked"),l=[];o.find('[name="setWeek"]:checked').each(function(){l.push($(this).val())});var i=[];if(d){var s=t.handleSetDateRangeData(n,c);if(!s)return;if(i=s,0===l.length)return void t.handleThisData(r,i)}else{if(0===l.length)return void t.handleThisData(r);i=t.handleSetDateRangeData(formatDate(t.startDate,"yyyy-MM-dd"),formatDate(t.endDate,"yyyy-MM-dd"))}t.handleSetWeekData(l,i,function(e){e.data.length>0?t.handleThisData(r,e.data):t.opts.error&&t.opts.error({code:3,msg:CODES[3].replace("{{text}}",l.join(","))})})})},fn.handleSetDateRangeData=function(t,e){var a=this,r=[],o=isValid(t),n=isValid(e);return o?o<today?(this.opts.error&&this.opts.error({code:5,msg:CODES[5]}),!1):n?n<o?(this.opts.error&&this.opts.error({code:7,msg:CODES[7]}),!1):(o==n?r.push(formatDate(this.dateToObject(o),"yyyy-MM-dd")):r=function(t,e){for(var r=[],o=Date.parse(a.dateToObject(t)),n=Date.parse(a.dateToObject(e)),c=Math.floor((n-o)/ONE_DAY_MSEC)+1,d=0;d<c;d++){var l=new Date(o+ONE_DAY_MSEC*d);r.push(formatDate(l,"yyyy-MM-dd"))}return r}(o,n),r):(this.opts.error&&this.opts.error({code:6,msg:CODES[6]}),!1):(this.opts.error&&this.opts.error({code:4,msg:CODES[4]}),!1)},fn.handleSetWeekData=function(t,e,a){var r=this,o=t.join(","),n=[];$.each(e,function(t,e){var a=r.dateToObject(e).getDay();o.indexOf(a)>-1&&n.push(e)}),a&&a({code:0,msg:"completed",data:n})},fn.handleThisData=function(t,e){var a=e||[],r=a.length;if(0===r)this._updateThisData(t);else for(var o=0;o<r;o++)this._updateThisData(t,a[o]);this.data=this.sort(this.rmRepeat(this.data,"date")),this.renderDataToTalbe(),$(".capricorncd-date-detailed-settings").hide()},fn._updateThisData=function(t,e){var a=this,r=!1,o={};o.date=e||t.date,$.each(t,function(t,e){"date"!=t&&(o[t]=e)}),$.each(this.data,function(t,e){if(o.date===e.date)return r=!0,a.data[t]=o,!1}),r||this.data.push(o)},fn._getOptionsData=function(){var t=formatDate(this.startDate,"yyyy-MM-dd"),e=[],a=this.opts.data;if(a&&a instanceof Array)for(var r=0;r<a.length;r++)a[r].date>=t&&e.push(a[r]);return this.sort(this.rmRepeat(e,"date"))},fn.createStyleCode=function(){var style=this.opts.style||{},count=0;for(var key in style)if(++count>0)break;if(count){var defaultStyle={headerBgColor:"#098cc2",headerTextColor:"#fff",weekBgColor:"#098cc2",weekTextColor:"#fff",weekendBgColor:"#098cc2",weekendTextColor:"#fff",validDateTextColor:"#333",validDateBgColor:"#fff",validDateBorderColor:"#eee",validDateHoverBgColor:"#098cc2",validDateHoverTextColor:"#fff",invalidDateTextColor:"#ccc",invalidDateBgColor:"#fff",invalidDateBorderColor:"#eee",footerBgColor:"#fff",resetBtnBgColor:"#77c351",resetBtnTextColor:"#fff",resetBtnHoverBgColor:"#55b526",resetBtnHoverTextColor:"#fff",confirmBtnBgColor:"#098cc2",confirmBtnTextColor:"#fff",confirmBtnHoverBgColor:"#00649a",confirmBtnHoverTextColor:"#fff",cancelBtnBgColor:"#fff",cancelBtnBorderColor:"#bbb",cancelBtnTextColor:"#999",cancelBtnHoverBgColor:"#fff",cancelBtnHoverBorderColor:"#bbb",cancelBtnHoverTextColor:"#666"},concatStyle=$.extend({},defaultStyle,this.opts.style),templateStyle=".capricorncd-calendar-container .calendar-head-wrapper, .capricorncd-date-detailed-settings .cddsw-container .cddsw-head-wrapper{background-color: {headerBgColor}}.capricorncd-calendar-container .calendar-head-wrapper .calendar-month-title, .capricorncd-date-detailed-settings .cddsw-container .cddsw-head-wrapper .cddsw-title{color: {headerTextColor};}.capricorncd-calendar-container .calendar-table-wrapper table .week{background-color:{weekBgColor};color:{weekTextColor}};.capricorncd-calendar-container .calendar-table-wrapper table .week th.weekend{background-color:{weekendBgColor};color:{weekendTextColor}}.capricorncd-calendar-container .calendar-table-wrapper table td{color:{validDateTextColor};background-color:{validDateBgColor};border-bottom: 1px solid {validDateBorderColor};border-right: 1px solid {validDateBorderColor};}.capricorncd-calendar-container .calendar-table-wrapper table td.valid-hook:hover{background-color:{validDateHoverBgColor};}.capricorncd-calendar-container .calendar-table-wrapper table td.valid-hook:hover b, .capricorncd-calendar-container .calendar-table-wrapper table td.valid-hook:hover p{color: {validDateHoverTextColor}}.capricorncd-calendar-container .calendar-table-wrapper table td.disabled{color:{invalidDateTextColor};background-color:{invalidDateBgColor}; border-bottom: 1px solid {invalidDateBorderColor};border-right: 1px solid {invalidDateBorderColor};}.capricorncd-calendar-container .calendar-foot-wrapper, .capricorncd-date-detailed-settings .cddsw-foot-wrapper{background-color:{footerBgColor}}.capricorncd-calendar-container .calendar-foot-wrapper button.btn-reset{background-color: {resetBtnBgColor};border: 1px solid {resetBtnBgColor};color: {resetBtnTextColor}}.capricorncd-calendar-container .calendar-foot-wrapper button.btn-reset:hover{background-color: {resetBtnHoverBgColor};border: 1px solid {resetBtnHoverBgColor};color: {resetBtnHoverTextColor}}.capricorncd-calendar-container .calendar-foot-wrapper button.btn-confirm, .capricorncd-date-detailed-settings .cddsw-foot-wrapper button.btn-confirm {background-color: {confirmBtnBgColor};border: 1px solid {confirmBtnBgColor};color: {confirmBtnTextColor}}.capricorncd-calendar-container .calendar-foot-wrapper button.btn-confirm:hover, .capricorncd-date-detailed-settings .cddsw-foot-wrapper button.btn-confirm:hover {background-color: {confirmBtnHoverBgColor};border: 1px solid {confirmBtnHoverBgColor};color: {confirmBtnHoverTextColor}}.capricorncd-calendar-container .calendar-foot-wrapper button.btn-cancel, .capricorncd-date-detailed-settings .cddsw-foot-wrapper button.btn-cancel {background-color: {cancelBtnBgColor};color:{cancelBtnTextColor};border: 1px solid {cancelBtnBorderColor};}.capricorncd-calendar-container .calendar-foot-wrapper button.btn-cancel:hover, .capricorncd-date-detailed-settings .cddsw-foot-wrapper button.btn-cancel:hover {background-color: {cancelBtnHoverBgColor};border-color: {cancelBtnHoverBorderColor};color: {cancelBtnHoverTextColor}}",reg=null;for(var key in concatStyle)reg=eval("/{"+key+"}/g"),templateStyle=templateStyle.replace(reg,concatStyle[key]);$("head").append("<style>"+templateStyle+"</style>")}},fn.sort=function(t){if(!(t instanceof Array))return this.opts.error&&this.opts.error({code:8,msg:CODES[8]}),t;if(t.length<1)return t;for(var e=0,a=null,r=0;r<t.length;r++){e=r;for(var o=r+1;o<t.length;o++)t[o].date<t[e].date&&(e=o,a=t[r],t.splice(r,1,t[o]),t.splice(o,1,a))}return t},fn.rmRepeat=function(t,e){for(var a={},r=[],o=0;o<t.length;o++){var n=t[o];if(e)try{n=t[o][e]}catch(t){}a[n]||(r.push(t[o]),a[n]=!0)}return r},$.extend({CalendarPrice:function(t){new CalendarPrice(t)}})}(jQuery);